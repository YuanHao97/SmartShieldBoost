<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ETH‰∫§ÊòìÊ®°ÊãüÂô® - ÂÆûÊó∂‰ª∑Ê†ºÁõëÊéß</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .price-card {
            text-align: center;
        }

        .current-price {
            font-size: 3rem;
            font-weight: bold;
            color: #4CAF50;
            margin: 20px 0;
        }

        .price-change {
            font-size: 1.2rem;
            margin: 10px 0;
        }

        .positive {
            color: #4CAF50;
        }

        .negative {
            color: #f44336;
        }

        .pool-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .info-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .info-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
        }

        .trading-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .trading-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .form-group input {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-buy {
            background: #4CAF50;
            color: white;
        }

        .btn-buy:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-sell {
            background: #f44336;
            color: white;
        }

        .btn-sell:hover {
            background: #da190b;
            transform: translateY(-2px);
        }

        .btn-simulate {
            background: #2196F3;
            color: white;
            width: 100%;
            margin-top: 10px;
        }

        .btn-simulate:hover {
            background: #1976D2;
        }

        .trades-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .trades-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .trades-header h3 {
            color: #333;
        }

        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .refresh-btn:hover {
            background: #5a6fd8;
        }

        .trades-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .trade-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #eee;
            transition: background-color 0.3s ease;
        }

        .trade-item:hover {
            background-color: #f8f9fa;
        }

        .trade-item:last-child {
            border-bottom: none;
        }

        .trade-type {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .trade-type.buy {
            background: #e8f5e8;
            color: #4CAF50;
        }

        .trade-type.sell {
            background: #ffeaea;
            color: #f44336;
        }

        .trade-details {
            flex: 1;
            margin: 0 15px;
        }

        .trade-amount {
            font-weight: bold;
            color: #333;
        }

        .trade-price {
            color: #666;
            font-size: 0.9rem;
        }

        .trade-time {
            color: #999;
            font-size: 0.8rem;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .chart {
            width: 100%;
            height: 300px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .status {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 20px 0;
        }

        .status.connected {
            background: #e8f5e8;
            color: #4CAF50;
        }

        .status.disconnected {
            background: #ffeaea;
            color: #f44336;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .trading-form {
                grid-template-columns: 1fr;
            }
            
            .pool-info {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ ETH‰∫§ÊòìÊ®°ÊãüÂô®</h1>
            <p>ÂÆûÊó∂ÁõëÊéßETH‰ª∑Ê†ºÊ≥¢Âä®Âíå‰∫§ÊòìÊ¥ªÂä®</p>
        </div>

        <div class="status" id="status">
            <div>üîå Ê≠£Âú®ËøûÊé•Âå∫ÂùóÈìæÁΩëÁªú...</div>
        </div>
        
        <div class="status" id="updateStatus" style="display: none;">
            <div>‚è∞ ‰∏ãÊ¨°Êõ¥Êñ∞: <span id="countdown">3</span>Áßí</div>
        </div>

        <div class="dashboard">
            <div class="card price-card">
                <h3>üí∞ ÂΩìÂâçETH‰ª∑Ê†º</h3>
                <div class="current-price" id="currentPrice">100.00 PYUSD</div>
                <div class="price-change" id="priceChange">
                    <span id="priceChangeText">+0.00%</span>
                </div>
            </div>

            <div class="card">
                <h3>üè¶ ÊµÅÂä®ÊÄßÊ±†‰ø°ÊÅØ</h3>
                <div class="pool-info">
                    <div class="info-item">
                        <div class="info-label">ETHÂÇ®Â§á</div>
                        <div class="info-value" id="ethReserve">100.00 ETH</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">PYUSDÂÇ®Â§á</div>
                        <div class="info-value" id="pyusdReserve">10,000.00 PYUSD</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ÊÄªÊµÅÂä®ÊÄß</div>
                        <div class="info-value" id="totalLiquidity">20,000.00</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">‰∫§ÊòìÊ¨°Êï∞</div>
                        <div class="info-value" id="tradeCount">0</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <h3>üìà ‰ª∑Ê†ºËµ∞ÂäøÂõæ</h3>
            <canvas id="priceChart" class="chart"></canvas>
        </div>

        <div class="trading-section">
            <h3>üíº ‰∫§ÊòìÊìç‰Ωú</h3>
            <div class="trading-form">
                <div class="form-group">
                    <label for="ethAmount">ETHÊï∞Èáè</label>
                    <input type="number" id="ethAmount" placeholder="ËæìÂÖ•ETHÊï∞Èáè" step="0.01" min="0.01">
                </div>
                <div class="form-group">
                    <label for="pyusdAmount">PYUSDÊï∞Èáè</label>
                    <input type="number" id="pyusdAmount" placeholder="Ëá™Âä®ËÆ°ÁÆó" readonly>
                </div>
            </div>
            <div style="text-align: center;">
                <button class="btn btn-buy" onclick="buyETH()">üü¢ ‰π∞ÂÖ•ETH</button>
                <button class="btn btn-sell" onclick="sellETH()">üî¥ ÂçñÂá∫ETH</button>
                <button class="btn btn-simulate" onclick="startSimulation()">üé≤ ÂºÄÂßãÊ®°Êãü‰∫§Êòì</button>
                <button class="btn btn-simulate" onclick="stopSimulation()" style="background: #f44336; margin-top: 10px;">‚èπÔ∏è ÂÅúÊ≠¢Ê®°Êãü‰∫§Êòì</button>
            </div>
        </div>

        <div class="trades-section">
            <div class="trades-header">
                <h3>üìã ÊúÄÊñ∞‰∫§ÊòìËÆ∞ÂΩï</h3>
                <button class="refresh-btn" onclick="refreshTrades()">üîÑ Âà∑Êñ∞</button>
            </div>
            <div class="trades-list" id="tradesList">
                <div style="text-align: center; color: #666; padding: 20px;">
                    ÊöÇÊó†‰∫§ÊòìËÆ∞ÂΩï
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let currentPrice = 100;
        let initialPrice = 100;
        let tradeHistory = [];
        let priceHistory = [];
        let chart = null;
        let simulationInterval = null;
        let countdownInterval = null;
        let countdown = 10;

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            initializeChart();
            updateStatus('connected', '‚úÖ Â∑≤ËøûÊé•Âà∞Âå∫ÂùóÈìæÁΩëÁªú');
            loadTradeHistory();
            startPriceUpdates();
            startCountdown();
        });

        // ÂàùÂßãÂåñÂõæË°®
        function initializeChart() {
            const ctx = document.getElementById('priceChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'ETH‰ª∑Ê†º (PYUSD)',
                        data: [],
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            type: 'linear',
                            title: {
                                display: true,
                                text: '‰ª∑Ê†º (PYUSD)',
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toFixed(2);
                                },
                                font: {
                                    size: 10
                                }
                            }
                        },
                        x: {
                            type: 'time',
                            time: {
                                displayFormats: {
                                    second: 'HH:mm:ss',
                                    minute: 'HH:mm',
                                    hour: 'HH:mm',
                                    day: 'MM-dd'
                                },
                                tooltipFormat: 'MM-dd HH:mm:ss'
                            },
                            adapters: {
                                date: {
                                    locale: 'zh-CN'
                                }
                            },
                            title: {
                                display: true,
                                text: 'Êó∂Èó¥',
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                font: {
                                    size: 10
                                },
                                maxRotation: 45,
                                minRotation: 0
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                }
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return `‰ª∑Ê†º: ${context.parsed.y.toFixed(2)} PYUSD`;
                                }
                            }
                        }
                    },
                    elements: {
                        point: {
                            radius: 3,
                            hoverRadius: 6
                        }
                    }
                }
            });
        }

        // Êõ¥Êñ∞Áä∂ÊÄÅ
        function updateStatus(type, message) {
            const statusEl = document.getElementById('status');
            statusEl.className = `status ${type}`;
            statusEl.innerHTML = `<div>${message}</div>`;
        }

        // Êõ¥Êñ∞‰ª∑Ê†ºÊòæÁ§∫
        function updatePriceDisplay() {
            document.getElementById('currentPrice').textContent = `${currentPrice.toFixed(2)} PYUSD`;
            
            const change = ((currentPrice - initialPrice) / initialPrice * 100).toFixed(2);
            const changeEl = document.getElementById('priceChangeText');
            changeEl.textContent = `${change >= 0 ? '+' : ''}${change}%`;
            changeEl.className = change >= 0 ? 'positive' : 'negative';
        }

        // Êõ¥Êñ∞Ê±†Â≠ê‰ø°ÊÅØ
        function updatePoolInfo() {
            // Ê®°ÊãüÊï∞ÊçÆÊõ¥Êñ∞
            const ethReserve = 100 - (tradeHistory.filter(t => t.isBuy).length * 0.1);
            const pyusdReserve = 10000 + (tradeHistory.length * 10);
            
            document.getElementById('ethReserve').textContent = `${ethReserve.toFixed(2)} ETH`;
            document.getElementById('pyusdReserve').textContent = `${pyusdReserve.toLocaleString()} PYUSD`;
            document.getElementById('totalLiquidity').textContent = `${(ethReserve + pyusdReserve / 100).toFixed(2)}`;
            document.getElementById('tradeCount').textContent = tradeHistory.length;
        }

        // ÂºÄÂßã‰ª∑Ê†ºÊõ¥Êñ∞
        function startPriceUpdates() {
            setInterval(() => {
                // Ê®°Êãü‰ª∑Ê†ºÊ≥¢Âä®
                const change = (Math.random() - 0.5) * 2; // -1 Âà∞ +1 ÁöÑÈöèÊú∫ÂèòÂåñ
                currentPrice = Math.max(50, currentPrice + change); // ÊúÄ‰Ωé50 PYUSD
                
                priceHistory.push({
                    time: new Date(),
                    price: currentPrice
                });
                
                // ‰øùÊåÅÊúÄËøë100‰∏™Êï∞ÊçÆÁÇπ
                if (priceHistory.length > 100) {
                    priceHistory.shift();
                }
                
                updatePriceDisplay();
                updateChart();
                startCountdown();
            }, 3000); // Êîπ‰∏∫3ÁßíÊõ¥Êñ∞‰∏ÄÊ¨°
        }

        // ÂºÄÂßãÂÄíËÆ°Êó∂
        function startCountdown() {
            countdown = 10;
            document.getElementById('updateStatus').style.display = 'block';
            
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            countdownInterval = setInterval(() => {
                countdown--;
                document.getElementById('countdown').textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    document.getElementById('updateStatus').style.display = 'none';
                }
            }, 1000);
        }

        // Êõ¥Êñ∞ÂõæË°®
        function updateChart() {
            if (chart && priceHistory.length > 0) {
                // ‰∏∫Êó∂Èó¥ËΩ¥ÂáÜÂ§áÊï∞ÊçÆ
                const chartData = priceHistory.map(p => ({
                    x: p.time,
                    y: p.price
                }));
                
                chart.data.datasets[0].data = chartData;
                
                // Ëá™ÈÄÇÂ∫îYËΩ¥ËåÉÂõ¥
                const prices = priceHistory.map(p => p.price);
                const minPrice = Math.min(...prices);
                const maxPrice = Math.max(...prices);
                const priceRange = maxPrice - minPrice;
                const padding = priceRange * 0.1; // 10%ÁöÑËæπË∑ù
                
                chart.options.scales.y.min = Math.max(0, minPrice - padding);
                chart.options.scales.y.max = maxPrice + padding;
                
                chart.update('none');
            }
        }

        // ‰π∞ÂÖ•ETH
        function buyETH() {
            const ethAmount = parseFloat(document.getElementById('ethAmount').value);
            if (!ethAmount || ethAmount <= 0) {
                alert('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑETHÊï∞Èáè');
                return;
            }
            
            // Ê®°Êãü‰∫§Êòì
            const pyusdNeeded = ethAmount * currentPrice;
            const newPrice = currentPrice * 1.01; // ‰ª∑Ê†º‰∏äÊ∂®1%
            
            addTrade(true, ethAmount, pyusdNeeded, newPrice);
            currentPrice = newPrice;
            
            updatePriceDisplay();
            updatePoolInfo();
            updateTradesList();
        }

        // ÂçñÂá∫ETH
        function sellETH() {
            const ethAmount = parseFloat(document.getElementById('ethAmount').value);
            if (!ethAmount || ethAmount <= 0) {
                alert('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑETHÊï∞Èáè');
                return;
            }
            
            // Ê®°Êãü‰∫§Êòì
            const pyusdReceived = ethAmount * currentPrice;
            const newPrice = currentPrice * 0.99; // ‰ª∑Ê†º‰∏ãË∑å1%
            
            addTrade(false, ethAmount, pyusdReceived, newPrice);
            currentPrice = newPrice;
            
            updatePriceDisplay();
            updatePoolInfo();
            updateTradesList();
        }

        // Ê∑ªÂä†‰∫§ÊòìËÆ∞ÂΩï
        function addTrade(isBuy, ethAmount, pyusdAmount, price) {
            const trade = {
                id: Date.now(),
                isBuy: isBuy,
                ethAmount: ethAmount,
                pyusdAmount: pyusdAmount,
                price: price,
                timestamp: new Date()
            };
            
            tradeHistory.unshift(trade);
            
            // ‰øùÊåÅÊúÄËøë50Á¨î‰∫§Êòì
            if (tradeHistory.length > 50) {
                tradeHistory.pop();
            }
        }

        // Êõ¥Êñ∞‰∫§ÊòìÂàóË°®
        function updateTradesList() {
            const tradesList = document.getElementById('tradesList');
            
            if (tradeHistory.length === 0) {
                tradesList.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">ÊöÇÊó†‰∫§ÊòìËÆ∞ÂΩï</div>';
                return;
            }
            
            tradesList.innerHTML = tradeHistory.slice(0, 20).map(trade => `
                <div class="trade-item">
                    <div class="trade-type ${trade.isBuy ? 'buy' : 'sell'}">
                        ${trade.isBuy ? '‰π∞ÂÖ•' : 'ÂçñÂá∫'}
                    </div>
                    <div class="trade-details">
                        <div class="trade-amount">${trade.ethAmount} ETH</div>
                        <div class="trade-price">${trade.pyusdAmount.toFixed(2)} PYUSD</div>
                    </div>
                    <div class="trade-time">${trade.timestamp.toLocaleTimeString()}</div>
                </div>
            `).join('');
        }

        // ÂºÄÂßãÊ®°Êãü‰∫§Êòì
        function startSimulation() {
            if (simulationInterval) {
                clearInterval(simulationInterval);
            }
            
            updateStatus('connected', 'üé≤ Ê®°Êãü‰∫§ÊòìËøõË°å‰∏≠...');
            
            simulationInterval = setInterval(() => {
                const isBuy = Math.random() > 0.5;
                const ethAmount = Math.random() * 2 + 0.1; // 0.1-2.1 ETH
                
                if (isBuy) {
                    const pyusdNeeded = ethAmount * currentPrice;
                    const newPrice = currentPrice * (1 + Math.random() * 0.02); // 0-2%‰∏äÊ∂®
                    addTrade(true, ethAmount, pyusdNeeded, newPrice);
                    currentPrice = newPrice;
                } else {
                    const pyusdReceived = ethAmount * currentPrice;
                    const newPrice = currentPrice * (1 - Math.random() * 0.02); // 0-2%‰∏ãË∑å
                    addTrade(false, ethAmount, pyusdReceived, newPrice);
                    currentPrice = newPrice;
                }
                
                updatePriceDisplay();
                updatePoolInfo();
                updateTradesList();
            }, 3000); // Êîπ‰∏∫3ÁßíÊõ¥Êñ∞‰∏ÄÊ¨°
        }

        // ÂÅúÊ≠¢Ê®°Êãü‰∫§Êòì
        function stopSimulation() {
            if (simulationInterval) {
                clearInterval(simulationInterval);
                simulationInterval = null;
                updateStatus('connected', '‚úÖ Ê®°Êãü‰∫§ÊòìÂ∑≤ÂÅúÊ≠¢');
            }
        }

        // Âà∑Êñ∞‰∫§ÊòìËÆ∞ÂΩï
        function refreshTrades() {
            updateTradesList();
        }

        // Âä†ËΩΩ‰∫§ÊòìÂéÜÂè≤
        function loadTradeHistory() {
            // ËøôÈáåÂèØ‰ª•Âä†ËΩΩ‰øùÂ≠òÁöÑ‰∫§ÊòìÂéÜÂè≤
            updateTradesList();
        }

        // ETHÊï∞ÈáèËæìÂÖ•ÂèòÂåñÊó∂Êõ¥Êñ∞PYUSDÊï∞Èáè
        document.getElementById('ethAmount').addEventListener('input', function() {
            const ethAmount = parseFloat(this.value);
            if (ethAmount > 0) {
                const pyusdAmount = ethAmount * currentPrice;
                document.getElementById('pyusdAmount').value = pyusdAmount.toFixed(2);
            }
        });
    </script>
</body>
</html>
